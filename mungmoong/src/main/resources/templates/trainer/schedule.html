<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/layouts/trainer_layout}">
<!-- ⭐ layout:decorate="~{/레이아웃 경로/레이아웃 파일명}" -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스케쥴 관리</title>

    <!-- ⭐ layout:fragment="레이아웃 프레그먼트 이름" -->
</head>

<body class="body" layout:fragment="content">
    <div class="container">
        <div class="inner">
            <div class="title-container">
                <h1 class="title">스케쥴 관리</h1>
            </div>
            <nav class="navbar navbar-expand-lg navbar-light">
                <div class="collapse navbar-collapse justify-content-start">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="tab-button" th:href="|/trainer/info?userId=${session.user.userId}|">훈련사 정보</a>
                        </li>
                        <li class="nav-item">
                            <a class="tab-button active" href="/trainer/schedule">스케쥴 관리</a>
                        </li>
                        <li class="nav-item">
                            <a class="tab-button" href="/trainer/status">내 작업현황</a>
                        </li>
                        <li class="nav-item">
                            <a class="tab-button" href="/trainer/deposit">입금 내역서</a>
                        </li>
                        <li class="nav-item">
                            <a class="tab-button" href="/trainer/reserve">예약</a>
                        </li>
                    </ul>
                </div>
            </nav>
            <div class="calendar-container">
                <div class="calendar">
                    <div class="header">
                        <button id="prev-month">❮</button>
                        <span id="month-year">2024년 5월</span>
                        <button id="next-month">❯</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>일</th>
                                <th>월</th>
                                <th>화</th>
                                <th>수</th>
                                <th>목</th>
                                <th>금</th>
                                <th>토</th>
                            </tr>
                        </thead>
                        <tbody id="calendar-body">
                            <!-- Calendar dates will be dynamically generated here -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="div_msg">
                <p class="msg">휴무일을 선택해주세요.</p>
            </div>
            <div class="text-end">
                <button type="button" class="btn-custom2">저장</button>
            </div>
        </div>
    </div>
    <script>

        const now = new Date();
        const year = now.getFullYear();
        const month = now.getMonth();

        let currentYear = year;
        let currentMonth = month; 

        let clickedDateList = new Array()

        

        const monthNames = [
            "1월", "2월", "3월", "4월", "5월", "6월",
            "7월", "8월", "9월", "10월", "11월", "12월"
        ];

        const holidays = {
            "1-1": "신정",
            "3-1": "삼일절",
            "5-5": "어린이날",
            "6-6": "현충일",
            "8-15": "광복절",
            "10-3": "개천절",
            "10-9": "한글날",
            "12-25": "성탄절"
        };

        document.getElementById('prev-month').addEventListener('click', () => {
            changeMonth(-1);
        });

        document.getElementById('next-month').addEventListener('click', () => {
            changeMonth(1);
        });


        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            updateCalendar();
        }

        function updateCalendar() {
            const calendarBody = document.getElementById('calendar-body');
            calendarBody.innerHTML = '';
            document.getElementById('month-year').innerText = `${currentYear}년 ${monthNames[currentMonth]}`;

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            let date = 1;
            for (let i = 0; i < 6; i++) {
                const row = document.createElement('tr');

                for (let j = 0; j < 7; j++) {
                    const cell = document.createElement('td');
                    if (i === 0 && j < firstDay) {
                        cell.innerHTML = '';
                    } else if (date > daysInMonth) {
                        break;
                    } else {
                        const dateKey = `${currentMonth + 1}-${date}`;
                        cell.innerHTML = date;
                        cell.classList.add('clickable');
                        if (holidays[dateKey]) {
                            cell.classList.add('holiday');
                        }
                        cell.addEventListener('click', () => {
                            // const selectedDate = `${currentYear}년 ${currentMonth + 1}월 ${date}일`;
                            // document.getElementById('selected-date').innerText = `선택된 날짜: ${selectedDate}`;
                            // console.log(`날짜 클릭됨: ${selectedDate}`);
                        });
                        date++;
                    }
                    row.appendChild(cell);
                }

                calendarBody.appendChild(row);
            }
        }

        updateCalendar();

        document.addEventListener("DOMContentLoaded", function() {
            let $dateButtons = document.getElementsByClassName('clickable')
            
            for (let i = 0; i < $dateButtons.length; i++) {
                const btn = $dateButtons[i];
                // 날짜 클릭 이벤트
                btn.addEventListener('click', () => {
                    let clickedDay = btn.textContent
                    let clickedDate = `${currentYear}-${currentMonth}-${clickedDay}`

                    if( btn.classList.contains('clicked') ) {
                        btn.classList.remove('clicked')
                        // 선택한 날짜 배열에서 제거
                        // clickedDateList.remove(clickedDate)
                        const index = clickedDateList.indexOf(clickedDate);
                        if (index !== -1) {
                            clickedDateList.splice(index, 1);
                        }
                    }
                    else {
                        btn.classList.add('clicked')
                        // 선택한 날짜 배열에 추가
                        clickedDateList.push(clickedDate)
                    }
                    alert(clickedDateList)
                });
            }
            
        })
    </script>
</body>

</html>
